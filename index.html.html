<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .mode-toggle {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
        }

        .mode-btn {
            background: rgba(255,255,255,0.2);
            border: 2px solid rgba(255,255,255,0.3);
            color: white;
            padding: 12px 30px;
            margin: 0 10px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 16px;
            backdrop-filter: blur(10px);
        }

        .mode-btn.active, .mode-btn:hover {
            background: rgba(255,255,255,0.3);
            border-color: rgba(255,255,255,0.6);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .panel {
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            margin-bottom: 20px;
        }

        .user-panel {
            display: block;
        }

        .admin-panel {
            display: none;
        }

        .search-section {
            margin-bottom: 30px;
        }

        .search-box {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .search-input {
            flex: 1;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102,126,234,0.1);
        }

        .search-btn, .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            transition: transform 0.2s ease;
        }

        .search-btn:hover, .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .map-container {
            position: relative;
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            height: 500px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .map-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            cursor: crosshair;
        }

        .point {
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            cursor: pointer;
            z-index: 100;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            animation: pulse 2s infinite;
        }

        .start-point {
            background: #28a745;
        }

        .end-point {
            background: #dc3545;
        }

        .classroom-point {
            background: #007bff;
        }

        @keyframes pulse {
            0% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.2); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }

        .path {
            position: absolute;
            height: 3px;
            background: linear-gradient(90deg, #28a745, #dc3545);
            z-index: 50;
            transform-origin: left center;
            border-radius: 2px;
            opacity: 0.8;
        }

        .classroom-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .classroom-item {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .classroom-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-color: #667eea;
        }

        .classroom-name {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .classroom-details {
            color: #666;
            font-size: 14px;
        }

        .admin-section {
            margin-bottom: 30px;
        }

        .admin-section h3 {
            color: #333;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }

        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102,126,234,0.1);
        }

        .file-upload {
            border: 2px dashed #ccc;
            padding: 30px;
            text-align: center;
            border-radius: 10px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .file-upload:hover {
            border-color: #667eea;
            background: rgba(102,126,234,0.05);
        }

        .file-upload input[type="file"] {
            display: none;
        }

        .status-message {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: bold;
        }

        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .info {
            background: #cce7ff;
            color: #1a5490;
            border: 1px solid #b3d9ff;
        }

        .google-sheets-section {
            background: rgba(34, 139, 34, 0.1);
            padding: 20px;
            border-radius: 10px;
            border-left: 5px solid #228b22;
        }

        .directions {
            background: rgba(255,255,255,0.9);
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
        }

        .directions h4 {
            color: #333;
            margin-bottom: 10px;
        }

        .directions p {
            color: #666;
            line-height: 1.5;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .mode-btn {
                padding: 10px 20px;
                font-size: 14px;
                margin: 0 5px;
            }

            .panel {
                padding: 20px;
            }

            .search-box {
                flex-direction: column;
            }

            .map-container {
                height: 300px;
            }

            .classroom-list {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè´ ‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h1>
            <p>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡∏∞‡∏ô‡∏≥‡∏ó‡∏≤‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏á‡πà‡∏≤‡∏¢‡∏î‡∏≤‡∏¢</p>
        </div>

        <div class="mode-toggle">
            <button class="mode-btn active" onclick="switchMode('user')">üë§ ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</button>
            <button class="mode-btn" onclick="switchMode('admin')">‚öôÔ∏è ‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö</button>
        </div>

        <!-- User Panel -->
        <div class="panel user-panel" id="userPanel">
            <div class="search-section">
                <h2>üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h2>
                <div class="search-box">
                    <input type="text" class="search-input" id="searchInput" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡πÄ‡∏ä‡πà‡∏ô ‡∏°.1/1, ‡∏´‡πâ‡∏≠‡∏á‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå, ‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏°‡∏∏‡∏î">
                    <button class="search-btn" onclick="searchClassroom()">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
                </div>
                <button class="btn" onclick="setStartPoint()" style="margin-right: 10px;">üìç ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏à‡∏∏‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô</button>
                <button class="btn" onclick="clearPath()">üßπ ‡∏•‡πâ‡∏≤‡∏á‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á</button>
            </div>

            <div class="map-container" id="mapContainer">
                <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 800 600'%3E%3Crect width='800' height='600' fill='%23f0f8ff'/%3E%3Ctext x='400' y='300' text-anchor='middle' font-size='24' fill='%23666'%3E‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô%3C/text%3E%3C/svg%3E" alt="‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô" class="map-image" id="mapImage" onclick="handleMapClick(event)">
            </div>

            <div class="directions" id="directions" style="display: none;">
                <h4>üó∫Ô∏è ‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á</h4>
                <p id="directionsText">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏∏‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÅ‡∏•‡∏∞‡∏à‡∏∏‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á</p>
            </div>

            <div class="classroom-list" id="classroomList">
                <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
            </div>
        </div>

        <!-- Admin Panel -->
        <div class="panel admin-panel" id="adminPanel">
            <div class="admin-section google-sheets-section">
                <h3>üìä ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets</h3>
                <div class="form-group">
                    <label>Google Sheets API Key:</label>
                    <input type="password" id="apiKey" placeholder="‡∏Å‡∏£‡∏≠‡∏Å Google Sheets API Key">
                </div>
                <div class="form-group">
                    <label>Spreadsheet ID:</label>
                    <input type="text" id="spreadsheetId" placeholder="‡∏Å‡∏£‡∏≠‡∏Å Google Sheets ID">
                </div>
                <div class="form-group">
                    <label>Sheet Name:</label>
                    <input type="text" id="sheetName" placeholder="‡∏ä‡∏∑‡πà‡∏≠ Sheet (‡πÄ‡∏ä‡πà‡∏ô classrooms)" value="classrooms">
                </div>
                <button class="btn" onclick="connectGoogleSheets()">üîó ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets</button>
                <button class="btn" onclick="syncFromSheets()" style="margin-left: 10px;">‚¨áÔ∏è ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Sheets</button>
                <button class="btn" onclick="syncToSheets()" style="margin-left: 10px;">‚¨ÜÔ∏è ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ Sheets</button>
                <div id="sheetsStatus"></div>
            </div>

            <div class="admin-section">
                <h3>üè¢ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h3>
                <div class="form-group">
                    <label>‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô:</label>
                    <input type="text" id="classroomName" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏°.1/1, ‡∏´‡πâ‡∏≠‡∏á‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå">
                </div>
                <div class="form-group">
                    <label>‡∏ä‡∏±‡πâ‡∏ô:</label>
                    <select id="classroomFloor">
                        <option value="1">‡∏ä‡∏±‡πâ‡∏ô 1</option>
                        <option value="2">‡∏ä‡∏±‡πâ‡∏ô 2</option>
                        <option value="3">‡∏ä‡∏±‡πâ‡∏ô 3</option>
                        <option value="4">‡∏ä‡∏±‡πâ‡∏ô 4</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£:</label>
                    <input type="text" id="classroomBuilding" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ A, ‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå">
                </div>
                <div class="form-group">
                    <label>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î:</label>
                    <textarea id="classroomDetails" placeholder="‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô"></textarea>
                </div>
                <div class="form-group">
                    <label>‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ö‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà:</label>
                    <input type="text" id="classroomPosition" placeholder="‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ö‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á" readonly>
                </div>
                <button class="btn" onclick="addClassroom()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button>
                <button class="btn" onclick="updateClassroom()" style="margin-left: 10px;">‚úèÔ∏è ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button>
                <button class="btn" onclick="deleteClassroom()" style="margin-left: 10px; background: #dc3545;">üóëÔ∏è ‡∏•‡∏ö‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button>
                <div id="adminStatus"></div>
            </div>

            <div class="admin-section">
                <h3>üó∫Ô∏è ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h3>
                <div class="file-upload" onclick="document.getElementById('mapUpload').click()">
                    <input type="file" id="mapUpload" accept="image/*" onchange="uploadMap(event)">
                    <p>üìÅ ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà ‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏°‡∏≤‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</p>
                    <p style="font-size: 12px; color: #666; margin-top: 10px;">‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå: JPG, PNG, SVG</p>
                </div>
            </div>

            <div class="admin-section">
                <h3>üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
                <div id="adminClassroomList">
                    <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏à‡∏≥‡∏•‡∏≠‡∏á
        let classrooms = [
            { id: 1, name: '‡∏°.1/1', floor: 1, building: '‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ A', details: '‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ä‡∏±‡πâ‡∏ô ‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 1', x: 150, y: 200 },
            { id: 2, name: '‡∏°.1/2', floor: 1, building: '‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ A', details: '‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ä‡∏±‡πâ‡∏ô ‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 1', x: 250, y: 200 },
            { id: 3, name: '‡∏´‡πâ‡∏≠‡∏á‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå', floor: 2, building: '‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ B', details: '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå', x: 400, y: 150 },
            { id: 4, name: '‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏°‡∏∏‡∏î', floor: 1, building: '‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ C', details: '‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏°‡∏∏‡∏î‡πÅ‡∏•‡∏∞‡πÅ‡∏´‡∏•‡πà‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ', x: 600, y: 300 },
            { id: 5, name: '‡∏´‡πâ‡∏≠‡∏á‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå', floor: 2, building: '‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ B', details: '‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå', x: 500, y: 150 }
        ];

        let currentMode = 'user';
        let startPoint = null;
        let endPoint = null;
        let isSettingStartPoint = false;
        let selectedClassroomId = null;
        let googleSheetsConnected = false;

        // Google Sheets Configuration
        let googleSheetsConfig = {
            apiKey: '',
            spreadsheetId: '',
            sheetName: 'classrooms'
        };

        // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÇ‡∏´‡∏°‡∏î‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡∏∞‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô
        function switchMode(mode) {
            currentMode = mode;
            const userPanel = document.getElementById('userPanel');
            const adminPanel = document.getElementById('adminPanel');
            const userBtn = document.querySelector('.mode-btn:first-child');
            const adminBtn = document.querySelector('.mode-btn:last-child');

            if (mode === 'user') {
                userPanel.style.display = 'block';
                adminPanel.style.display = 'none';
                userBtn.classList.add('active');
                adminBtn.classList.remove('active');
            } else {
                userPanel.style.display = 'none';
                adminPanel.style.display = 'block';
                adminBtn.classList.add('active');
                userBtn.classList.remove('active');
                displayAdminClassrooms();
            }
        }

        // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
        function searchClassroom() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const filteredClassrooms = classrooms.filter(classroom => 
                classroom.name.toLowerCase().includes(searchTerm) ||
                classroom.building.toLowerCase().includes(searchTerm) ||
                classroom.details.toLowerCase().includes(searchTerm)
            );
            
            displayClassrooms(filteredClassrooms);
            
            if (filteredClassrooms.length === 0) {
                showStatus('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤', 'error');
            } else {
                showStatus(`‡∏û‡∏ö‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ${filteredClassrooms.length} ‡∏´‡πâ‡∏≠‡∏á`, 'success');
            }
        }

        // ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
        function displayClassrooms(classroomList = classrooms) {
            const container = document.getElementById('classroomList');
            container.innerHTML = '';

            classroomList.forEach(classroom => {
                const item = document.createElement('div');
                item.className = 'classroom-item';
                item.innerHTML = `
                    <div class="classroom-name">${classroom.name}</div>
                    <div class="classroom-details">
                        üè¢ ${classroom.building} | üè¢ ‡∏ä‡∏±‡πâ‡∏ô ${classroom.floor}<br>
                        üìù ${classroom.details}
                    </div>
                `;
                item.onclick = () => selectClassroom(classroom);
                container.appendChild(item);
            });

            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏à‡∏∏‡∏î‡∏ö‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà
            updateMapPoints();
        }

        // ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
        function selectClassroom(classroom) {
            endPoint = { x: classroom.x, y: classroom.y };
            showStatus(`‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô: ${classroom.name}`, 'success');
            updateMapPoints();
            showDirections(classroom);
        }

        // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏à‡∏∏‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
        function setStartPoint() {
            isSettingStartPoint = true;
            showStatus('‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ö‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏à‡∏∏‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô', 'info');
        }

        // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ö‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà
        function handleMapClick(event) {
            if (currentMode === 'admin') {
                handleAdminMapClick(event);
                return;
            }

            const rect = event.target.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const y = event.clientY - rect.top;

            if (isSettingStartPoint) {
                startPoint = { x, y };
                isSettingStartPoint = false;
                showStatus('‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏à‡∏∏‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
                updateMapPoints();
            }
        }

        // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏•‡∏¥‡∏Å‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ô‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô
        function handleAdminMapClick(event) {
            const rect = event.target.getBoundingClientRect();
            const x = Math.round(event.clientX - rect.left);
            const y = Math.round(event.clientY - rect.top);
            
            document.getElementById('classroomPosition').value = `${x}, ${y}`;
            showAdminStatus('‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ö‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
        }

        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏à‡∏∏‡∏î‡∏ö‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà
        function updateMapPoints() {
            const container = document.getElementById('mapContainer');
            
            // ‡∏•‡πâ‡∏≤‡∏á‡∏à‡∏∏‡∏î‡πÄ‡∏î‡∏¥‡∏°
            const existingPoints = container.querySelectorAll('.point, .path');
            existingPoints.forEach(point => point.remove());

            // ‡πÅ‡∏™‡∏î‡∏á‡∏à‡∏∏‡∏î‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
            classrooms.forEach(classroom => {
                const point = document.createElement('div');
                point.className = 'point classroom-point';
                point.style.left = classroom.x + 'px';
                point.style.top = classroom.y + 'px';
                point.title = classroom.name;
                point.onclick = (e) => {
                    e.stopPropagation();
                    selectClassroom(classroom);
                };
                container.appendChild(point);
            });

            // ‡πÅ‡∏™‡∏î‡∏á‡∏à‡∏∏‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
            if (startPoint) {
                const point = document.createElement('div');
                point.className = 'point start-point';
                point.style.left = startPoint.x + 'px';
                point.style.top = startPoint.y + 'px';
                point.title = '‡∏à‡∏∏‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô';
                container.appendChild(point);
            }

            // ‡πÅ‡∏™‡∏î‡∏á‡∏à‡∏∏‡∏î‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á
            if (endPoint) {
                const point = document.createElement('div');
                point.className = 'point end-point';
                point.style.left = endPoint.x + 'px';
                point.style.top = endPoint.y + 'px';
                point.title = '‡∏à‡∏∏‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á';
                container.appendChild(point);
            }

            // ‡∏ß‡∏≤‡∏î‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á
            if (startPoint && endPoint) {
                drawPath(startPoint, endPoint);
            }
        }

        // ‡∏ß‡∏≤‡∏î‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á
        function drawPath(start, end) {
            const container = document.getElementById('mapContainer');
            const path = document.createElement('div');
            path.className = 'path';
            
            const distance = Math.sqrt(Math.pow(end.x - start.x, 2) + Math.pow(end.y - start.y, 2));
            const angle = Math.atan2(end.y - start.y, end.x - start.x) * 180 / Math.PI;
            
            path.style.width = distance + 'px';
            path.style.left = start.x + 'px';
            path.style.top = start.y + 'px';
            path.style.transform = `rotate(${angle}deg)`;
            
            container.appendChild(path);
        }

        // ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á
        function showDirections(classroom) {
            const directionsDiv = document.getElementById('directions');
            const directionsText = document.getElementById('directionsText');
            
            if (startPoint && endPoint) {
                const distance = Math.sqrt(Math.pow(endPoint.x - startPoint.x, 2) + Math.pow(endPoint.y - startPoint.y, 2));
                directionsText.innerHTML = `
                    üéØ <strong>‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á:</strong> ${classroom.name}<br>
                    üè¢ <strong>‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£:</strong> ${classroom.building} ‡∏ä‡∏±‡πâ‡∏ô ${classroom.floor}<br>
                    üìè <strong>‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á:</strong> ‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì ${Math.round(distance/10)} ‡πÄ‡∏°‡∏ï‡∏£<br>
                    üìù <strong>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î:</strong> ${classroom.details}
                `;
                directionsDiv.style.display = 'block';
            }
        }

        // ‡∏•‡πâ‡∏≤‡∏á‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á
        function clearPath() {
            startPoint = null;
            endPoint = null;
            updateMapPoints();
            document.getElementById('directions').style.display = 'none';
            document.getElementById('searchInput').value = '';
            displayClassrooms();
            showStatus('‡∏•‡πâ‡∏≤‡∏á‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'info');
        }

        // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
        function showStatus(message, type) {
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á status element ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ
            let statusDiv = document.getElementById('statusMessage');
            if (!statusDiv) {
                statusDiv = document.createElement('div');
                statusDiv.id = 'statusMessage';
                document.querySelector('.user-panel .search-section').appendChild(statusDiv);
            }
            
            statusDiv.className = `status-message ${type}`;
            statusDiv.textContent = message;
            statusDiv.style.display = 'block';
            
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 3000);
        }

        // =============== ADMIN FUNCTIONS ===============

        // ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets
        function connectGoogleSheets() {
            const apiKey = document.getElementById('apiKey').value;
            const spreadsheetId = document.getElementById('spreadsheetId').value;
            const sheetName = document.getElementById('sheetName').value;
            
            if (!apiKey || !spreadsheetId) {
                showAdminStatus('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å API Key ‡πÅ‡∏•‡∏∞ Spreadsheet ID', 'error');
                return;
            }
            
            googleSheetsConfig.apiKey = apiKey;
            googleSheetsConfig.spreadsheetId = spreadsheetId;
            googleSheetsConfig.sheetName = sheetName || 'classrooms';
            googleSheetsConnected = true;
            
            showAdminStatus('‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
        }

        // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheets
        async function syncFromSheets() {
            if (!googleSheetsConnected) {
                showAdminStatus('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets ‡∏Å‡πà‡∏≠‡∏ô', 'error');
                return;
            }
            
            try {
                showAdminStatus('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheets...', 'info');
                
                // ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡πÉ‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏∞‡πÉ‡∏ä‡πâ Google Sheets API)
                const mockData = [
                    { name: '‡∏°.2/1', floor: 2, building: '‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ A', details: '‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ä‡∏±‡πâ‡∏ô ‡∏°.2', x: 180, y: 150 },
                    { name: '‡∏´‡πâ‡∏≠‡∏á‡∏î‡∏ô‡∏ï‡∏£‡∏µ', floor: 3, building: '‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ C', details: '‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏î‡∏ô‡∏ï‡∏£‡∏µ‡πÅ‡∏•‡∏∞‡∏®‡∏¥‡∏•‡∏õ‡∏∞', x: 350, y: 400 }
                ];
                
                // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà
                mockData.forEach(data => {
                    const newId = Math.max(...classrooms.map(c => c.id)) + 1;
                    classrooms.push({ id: newId, ...data });
                });
                
                displayClassrooms();
                displayAdminClassrooms();
                showAdminStatus(`‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ${mockData.length} ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏à‡∏≤‡∏Å Google Sheets ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à`, 'success');
                
            } catch (error) {
                showAdminStatus('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', 'error');
            }
        }

        // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ Google Sheets
        async function syncToSheets() {
            if (!googleSheetsConnected) {
                showAdminStatus('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets ‡∏Å‡πà‡∏≠‡∏ô', 'error');
                return;
            }
            
            try {
                showAdminStatus('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ Google Sheets...', 'info');
                
                // ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡πÉ‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏∞‡πÉ‡∏ä‡πâ Google Sheets API)
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                showAdminStatus(`‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ${classrooms.length} ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÑ‡∏õ Google Sheets ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à`, 'success');
                
            } catch (error) {
                showAdminStatus('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', 'error');
            }
        }

        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏´‡∏°‡πà
        function addClassroom() {
            const name = document.getElementById('classroomName').value;
            const floor = document.getElementById('classroomFloor').value;
            const building = document.getElementById('classroomBuilding').value;
            const details = document.getElementById('classroomDetails').value;
            const position = document.getElementById('classroomPosition').value;
            
            if (!name || !building) {
                showAdminStatus('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡∏∞‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£', 'error');
                return;
            }
            
            let x = 100, y = 100;
            if (position) {
                const coords = position.split(',');
                x = parseInt(coords[0]) || 100;
                y = parseInt(coords[1]) || 100;
            }
            
            const newId = Math.max(...classrooms.map(c => c.id)) + 1;
            const newClassroom = {
                id: newId,
                name: name.trim(),
                floor: parseInt(floor),
                building: building.trim(),
                details: details.trim() || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°',
                x: x,
                y: y
            };
            
            classrooms.push(newClassroom);
            
            // ‡∏•‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°
            document.getElementById('classroomName').value = '';
            document.getElementById('classroomBuilding').value = '';
            document.getElementById('classroomDetails').value = '';
            document.getElementById('classroomPosition').value = '';
            
            displayClassrooms();
            displayAdminClassrooms();
            showAdminStatus(`‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô "${name}" ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢`, 'success');
        }

        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
        function updateClassroom() {
            if (!selectedClassroomId) {
                showAdminStatus('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï', 'error');
                return;
            }
            
            const name = document.getElementById('classroomName').value;
            const floor = document.getElementById('classroomFloor').value;
            const building = document.getElementById('classroomBuilding').value;
            const details = document.getElementById('classroomDetails').value;
            const position = document.getElementById('classroomPosition').value;
            
            if (!name || !building) {
                showAdminStatus('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡∏∞‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£', 'error');
                return;
            }
            
            const classroomIndex = classrooms.findIndex(c => c.id === selectedClassroomId);
            if (classroomIndex !== -1) {
                let x = classrooms[classroomIndex].x;
                let y = classrooms[classroomIndex].y;
                
                if (position) {
                    const coords = position.split(',');
                    x = parseInt(coords[0]) || x;
                    y = parseInt(coords[1]) || y;
                }
                
                classrooms[classroomIndex] = {
                    ...classrooms[classroomIndex],
                    name: name.trim(),
                    floor: parseInt(floor),
                    building: building.trim(),
                    details: details.trim() || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°',
                    x: x,
                    y: y
                };
                
                displayClassrooms();
                displayAdminClassrooms();
                showAdminStatus(`‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô "${name}" ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢`, 'success');
            }
        }

        // ‡∏•‡∏ö‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
        function deleteClassroom() {
            if (!selectedClassroomId) {
                showAdminStatus('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö', 'error');
                return;
            }
            
            const classroom = classrooms.find(c => c.id === selectedClassroomId);
            if (!classroom) return;
            
            if (confirm(`‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô "${classroom.name}" ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`)) {
                classrooms = classrooms.filter(c => c.id !== selectedClassroomId);
                selectedClassroomId = null;
                
                // ‡∏•‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°
                document.getElementById('classroomName').value = '';
                document.getElementById('classroomBuilding').value = '';
                document.getElementById('classroomDetails').value = '';
                document.getElementById('classroomPosition').value = '';
                
                displayClassrooms();
                displayAdminClassrooms();
                showAdminStatus(`‡∏•‡∏ö‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô "${classroom.name}" ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢`, 'success');
            }
        }

        // ‡πÅ‡∏™‡∏î‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏ô‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô
        function displayAdminClassrooms() {
            const container = document.getElementById('adminClassroomList');
            container.innerHTML = '';
            
            if (classrooms.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</p>';
                return;
            }
            
            classrooms.forEach(classroom => {
                const item = document.createElement('div');
                item.className = 'classroom-item';
                item.style.cursor = 'pointer';
                item.innerHTML = `
                    <div class="classroom-name">${classroom.name}</div>
                    <div class="classroom-details">
                        üè¢ ${classroom.building} | üè¢ ‡∏ä‡∏±‡πâ‡∏ô ${classroom.floor} | üìç (${classroom.x}, ${classroom.y})<br>
                        üìù ${classroom.details}
                    </div>
                `;
                
                item.onclick = () => selectAdminClassroom(classroom);
                
                // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏∏‡πà‡∏°‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£
                const actions = document.createElement('div');
                actions.style.marginTop = '10px';
                actions.innerHTML = `
                    <button class="btn" style="padding: 5px 10px; font-size: 12px; margin-right: 5px;" onclick="event.stopPropagation(); selectAdminClassroom(${JSON.stringify(classroom).replace(/"/g, '&quot;')})">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                    <button class="btn" style="padding: 5px 10px; font-size: 12px; background: #dc3545;" onclick="event.stopPropagation(); deleteSpecificClassroom(${classroom.id})">üóëÔ∏è ‡∏•‡∏ö</button>
                `;
                
                item.appendChild(actions);
                container.appendChild(item);
            });
        }

        // ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏ô‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô
        function selectAdminClassroom(classroom) {
            selectedClassroomId = classroom.id;
            
            document.getElementById('classroomName').value = classroom.name;
            document.getElementById('classroomFloor').value = classroom.floor;
            document.getElementById('classroomBuilding').value = classroom.building;
            document.getElementById('classroomDetails').value = classroom.details;
            document.getElementById('classroomPosition').value = `${classroom.x}, ${classroom.y}`;
            
            showAdminStatus(`‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô "${classroom.name}" ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç`, 'info');
        }

        // ‡∏•‡∏ö‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞
        function deleteSpecificClassroom(id) {
            const classroom = classrooms.find(c => c.id === id);
            if (!classroom) return;
            
            if (confirm(`‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô "${classroom.name}" ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`)) {
                classrooms = classrooms.filter(c => c.id !== id);
                
                if (selectedClassroomId === id) {
                    selectedClassroomId = null;
                    // ‡∏•‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°
                    document.getElementById('classroomName').value = '';
                    document.getElementById('classroomBuilding').value = '';
                    document.getElementById('classroomDetails').value = '';
                    document.getElementById('classroomPosition').value = '';
                }
                
                displayClassrooms();
                displayAdminClassrooms();
                showAdminStatus(`‡∏•‡∏ö‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô "${classroom.name}" ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢`, 'success');
            }
        }

        // ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà
        function uploadMap(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const mapImage = document.getElementById('mapImage');
                mapImage.src = e.target.result;
                showAdminStatus('‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
            };
            reader.readAsDataURL(file);
        }

        // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏ô‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô
        function showAdminStatus(message, type) {
            const statusDiv = document.getElementById('adminStatus');
            statusDiv.className = `status-message ${type}`;
            statusDiv.textContent = message;
            statusDiv.style.display = 'block';
            
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 3000);
        }

        // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Google Sheets
        function showSheetsStatus(message, type) {
            const statusDiv = document.getElementById('sheetsStatus');
            statusDiv.className = `status-message ${type}`;
            statusDiv.textContent = message;
            statusDiv.style.display = 'block';
            
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 3000);
        }

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
        function initializeSystem() {
            displayClassrooms();
            
            // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ drag and drop ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà
            const fileUpload = document.querySelector('.file-upload');
            
            fileUpload.addEventListener('dragover', (e) => {
                e.preventDefault();
                fileUpload.style.borderColor = '#667eea';
                fileUpload.style.background = 'rgba(102,126,234,0.1)';
            });
            
            fileUpload.addEventListener('dragleave', () => {
                fileUpload.style.borderColor = '#ccc';
                fileUpload.style.background = 'transparent';
            });
            
            fileUpload.addEventListener('drop', (e) => {
                e.preventDefault();
                fileUpload.style.borderColor = '#ccc';
                fileUpload.style.background = 'transparent';
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    uploadMap({ target: { files } });
                }
            });
            
            // ‡πÄ‡∏û‡∏¥‡πà‡∏° Enter key support ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
            document.getElementById('searchInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    searchClassroom();
                }
            });
        }

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏™‡∏£‡πá‡∏à
        document.addEventListener('DOMContentLoaded', initializeSystem);
    </script>
</body>
</html>